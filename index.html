<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Simulator</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; margin: 20px; background-color: #f4f7f6; color: #333; }
        .container { max-width: 1200px; margin: auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        h1, h2 { color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 25px; }
        .balance, .message { padding: 10px 15px; border-radius: 5px; margin-bottom: 20px; font-weight: bold; }
        .balance { background-color: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }
        .message.success { background-color: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }
        .message.error { background-color: #ffebee; color: #c62828; border: 1px solid #ffcdd2; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; background-color: #fdfdfd; }
        th, td { border: 1px solid #e0e0e0; padding: 12px 15px; text-align: left; }
        th { background-color: #f0f4f7; font-weight: 600; color: #555; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .trade-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; padding: 20px; border: 1px solid #e0e0e0; border-radius: 8px; background-color: #fafafa; }
        .trade-controls div { display: flex; flex-direction: column; }
        .trade-controls label { margin-bottom: 8px; font-weight: 500; color: #444; }
        .trade-controls input[type="text"], .trade-controls input[type="number"] { padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 1rem; }
        .trade-buttons { grid-column: span 2; display: flex; justify-content: flex-start; gap: 10px; }
        .trade-buttons button { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: background-color 0.2s ease; }
        .trade-buttons button.buy { background-color: #4CAF50; color: white; }
        .trade-buttons button.buy:hover { background-color: #43A047; }
        .trade-buttons button.sell { background-color: #F44336; color: white; }
        .trade-buttons button.sell:hover { background-color: #E53935; }
        #stockPrices td:nth-child(3) { font-weight: bold; }
        .price-up { color: #2e7d32; }
        .price-down { color: #c62828; }
        .flex-row { display: flex; gap: 20px; flex-wrap: wrap; }
        .flex-col { flex: 1; min-width: 300px; } /* Ensure responsiveness */
    </style>
</head>
<body>
    <div class="container">
        <h1>Market Simulation Platform</h1>

        <div class="balance">
            Your Balance: $<span id="userBalanceDisplay">10,000.00</span>
        </div>

        <div id="messageArea" class="message" style="display: none;"></div>

        <div class="flex-row">
            <div class="flex-col">
                <h2>Live Stock Prices</h2>
                <table id="stockPrices">
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Company</th>
                            <th>Price</th>
                            <th>Change</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Stock data will be injected here by JavaScript -->
                    </tbody>
                </table>
            </div>
            <div class="flex-col">
                <h2>Your Portfolio</h2>
                <table id="userPortfolio">
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Shares</th>
                            <th>Current Price</th>
                            <th>Total Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Portfolio data will be injected here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <h2>Trade Stocks</h2>
        <div class="trade-controls">
            <div>
                <label for="tradeSymbol">Stock Symbol:</label>
                <input type="text" id="tradeSymbol" placeholder="e.g., AAPL" list="availableSymbols">
                <datalist id="availableSymbols"></datalist>
            </div>
            <div>
                <label for="tradeQuantity">Quantity:</label>
                <input type="number" id="tradeQuantity" min="1" value="1">
            </div>
            <div class="trade-buttons">
                <button class="buy" onclick="handleTrade('buy')">Buy</button>
                <button class="sell" onclick="handleTrade('sell')">Sell</button>
            </div>
        </div>

        <h2>Transaction History</h2>
        <table id="transactionHistory">
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Symbol</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Timestamp</th>
                </tr>
            </thead>
            <tbody>
                <!-- Transaction history will be injected here by JavaScript -->
            </tbody>
        </table>
    </div>

    <script>
        const initialBalance = 10000;
        let userBalance = initialBalance;
        let portfolio = {}; // { 'AAPL': 10, 'GOOG': 5 }
        let transactions = [];
        let stocks = [
            { symbol: 'AAPL', name: 'Apple Inc.', price: 150.00, volatility: 0.02, prevPrice: 150.00 },
            { symbol: 'GOOG', name: 'Alphabet Inc.', price: 2500.00, volatility: 0.015, prevPrice: 2500.00 },
            { symbol: 'MSFT', name: 'Microsoft Corp.', price: 280.00, volatility: 0.018, prevPrice: 280.00 },
            { symbol: 'AMZN', name: 'Amazon.com Inc.', price: 3000.00, volatility: 0.025, prevPrice: 3000.00 },
            { symbol: 'TSLA', name: 'Tesla Inc.', price: 700.00, volatility: 0.03, prevPrice: 700.00 },
            { symbol: 'NFLX', name: 'Netflix Inc.', price: 400.00, volatility: 0.022, prevPrice: 400.00 },
            { symbol: 'FB', name: 'Meta Platforms Inc.', price: 350.00, volatility: 0.021, prevPrice: 350.00 }
        ];

        // DOM Elements
        const userBalanceDisplay = document.getElementById('userBalanceDisplay');
        const stockPricesTableBody = document.querySelector('#stockPrices tbody');
        const userPortfolioTableBody = document.querySelector('#userPortfolio tbody');
        const transactionHistoryTableBody = document.querySelector('#transactionHistory tbody');
        const tradeSymbolInput = document.getElementById('tradeSymbol');
        const tradeQuantityInput = document.getElementById('tradeQuantity');
        const messageArea = document.getElementById('messageArea');
        const availableSymbolsDatalist = document.getElementById('availableSymbols');

        // Helper function to format currency
        function formatCurrency(amount) {
            return amount.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        // Function to display messages
        function showMessage(msg, type = 'success') {
            messageArea.textContent = msg;
            messageArea.className = `message ${type}`;
            messageArea.style.display = 'block';
            setTimeout(() => {
                messageArea.style.display = 'none';
            }, 5000);
        }

        // Render functions
        function renderBalance() {
            userBalanceDisplay.textContent = formatCurrency(userBalance);
        }

        function renderStocks() {
            stockPricesTableBody.innerHTML = '';
            stocks.forEach(stock => {
                const row = stockPricesTableBody.insertRow();
                const priceChange = stock.price - stock.prevPrice;
                const changeClass = priceChange > 0 ? 'price-up' : priceChange < 0 ? 'price-down' : '';
                const changeArrow = priceChange > 0 ? ' ▲' : priceChange < 0 ? ' ▼' : '';
                
                row.insertCell().textContent = stock.symbol;
                row.insertCell().textContent = stock.name;
                const priceCell = row.insertCell();
                priceCell.textContent = formatCurrency(stock.price);
                const changeCell = row.insertCell();
                changeCell.innerHTML = `<span class="${changeClass}">${formatCurrency(priceChange)} ${changeArrow}</span>`;
            });
        }

        function renderPortfolio() {
            userPortfolioTableBody.innerHTML = '';
            let totalPortfolioValue = 0;

            const currentStockPricesMap = new Map(stocks.map(s => [s.symbol, s.price]));

            let portfolioIsEmpty = true;
            for (const symbol in portfolio) {
                const quantity = portfolio[symbol];
                if (quantity > 0) {
                    portfolioIsEmpty = false;
                    const currentPrice = currentStockPricesMap.get(symbol) || 0;
                    const totalValue = quantity * currentPrice;
                    totalPortfolioValue += totalValue;

                    const row = userPortfolioTableBody.insertRow();
                    row.insertCell().textContent = symbol;
                    row.insertCell().textContent = quantity;
                    row.insertCell().textContent = formatCurrency(currentPrice);
                    row.insertCell().textContent = formatCurrency(totalValue);
                }
            }
            if (portfolioIsEmpty) {
                 const row = userPortfolioTableBody.insertRow();
                 const cell = row.insertCell();
                 cell.colSpan = 4;
                 cell.textContent = "Your portfolio is empty.";
                 cell.style.textAlign = "center";
                 cell.style.fontStyle = "italic";
            }
        }

        function renderTransactionHistory() {
            transactionHistoryTableBody.innerHTML = '';
            transactions.forEach(tx => {
                const row = transactionHistoryTableBody.insertRow();
                row.insertCell().textContent = tx.type;
                row.insertCell().textContent = tx.symbol;
                row.insertCell().textContent = tx.quantity;
                row.insertCell().textContent = formatCurrency(tx.price);
                row.insertCell().textContent = tx.timestamp;
            });
            if (transactions.length === 0) {
                 const row = transactionHistoryTableBody.insertRow();
                 const cell = row.insertCell();
                 cell.colSpan = 5;
                 cell.textContent = "No transactions yet.";
                 cell.style.textAlign = "center";
                 cell.style.fontStyle = "italic";
            }
        }

        function populateDatalist() {
            availableSymbolsDatalist.innerHTML = '';
            stocks.forEach(stock => {
                const option = document.createElement('option');
                option.value = stock.symbol;
                option.textContent = `${stock.symbol} - ${stock.name}`;
                availableSymbolsDatalist.appendChild(option);
            });
        }

        // Trading logic
        function handleTrade(type) {
            const symbol = tradeSymbolInput.value.toUpperCase();
            const quantity = parseInt(tradeQuantityInput.value);

            if (!symbol || isNaN(quantity) || quantity <= 0) {
                showMessage('Please enter a valid stock symbol and a positive quantity.', 'error');
                return;
            }

            const stock = stocks.find(s => s.symbol === symbol);
            if (!stock) {
                showMessage(`Stock symbol "${symbol}" not found.`, 'error');
                return;
            }

            if (type === 'buy') {
                const cost = quantity * stock.price;
                if (userBalance >= cost) {
                    userBalance -= cost;
                    portfolio[symbol] = (portfolio[symbol] || 0) + quantity;
                    transactions.unshift({
                        type: 'BUY',
                        symbol,
                        quantity,
                        price: stock.price,
                        timestamp: new Date().toLocaleString()
                    });
                    showMessage(`Successfully bought ${quantity} shares of ${symbol} for ${formatCurrency(cost)}.`);
                } else {
                    showMessage(`Insufficient funds to buy ${quantity} shares of ${symbol}. You need ${formatCurrency(cost)}, but have ${formatCurrency(userBalance)}.`, 'error');
                }
            } else if (type === 'sell') {
                if (portfolio[symbol] && portfolio[symbol] >= quantity) {
                    const revenue = quantity * stock.price;
                    userBalance += revenue;
                    portfolio[symbol] -= quantity;
                    if (portfolio[symbol] === 0) {
                        delete portfolio[symbol];
                    }
                    transactions.unshift({
                        type: 'SELL',
                        symbol,
                        quantity,
                        price: stock.price,
                        timestamp: new Date().toLocaleString()
                    });
                    showMessage(`Successfully sold ${quantity} shares of ${symbol} for ${formatCurrency(revenue)}.`);
                } else {
                    showMessage(`Insufficient shares of ${symbol} to sell. You only have ${portfolio[symbol] || 0} shares.`, 'error');
                }
            }

            // Clear inputs and re-render all displays
            tradeSymbolInput.value = '';
            tradeQuantityInput.value = '1';
            renderAll();
        }

        // Price simulation and update
        function updateStockPrices() {
            stocks.forEach(stock => {
                stock.prevPrice = stock.price; // Store current price as previous
                const changeFactor = (Math.random() * stock.volatility * 2 - stock.volatility); // Random change between -volatility and +volatility
                stock.price += stock.price * changeFactor;
                // Ensure price doesn't go below a reasonable minimum
                stock.price = Math.max(0.01, stock.price); 
            });
            renderStocks();
            renderPortfolio(); // Portfolio value depends on current prices
        }

        // Initial setup and continuous updates
        function renderAll() {
            renderBalance();
            renderStocks();
            renderPortfolio();
            renderTransactionHistory();
        }

        function init() {
            renderAll();
            populateDatalist();
            setInterval(updateStockPrices, 3000); // Update prices every 3 seconds
        }

        // Run initialization when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>